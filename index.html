<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Certificado - Amigo da Vila Calderita</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
       
    </style>
</head>
<body>

    <h1>Certificado de Amigo(a) da Vila Calderita</h1>

    <label for="nome">Nome Completo:</label>
    <input type="text" id="nome" name="nome">

    <label for="data">Data da Emissão:</label>
    <input type="date" id="data" name="data">

    <button onclick="gerarCertificado()">Emitir Certificado</button>

    <script>
        function formatarDataParaPdf(dataString) {
            const dataObj = new Date(dataString + 'T00:00:00');
            const dia = dataObj.getDate();
            const mesIndex = dataObj.getMonth();
            const ano = dataObj.getFullYear();
            const diaFormatado = String(dia).padStart(2, '0');
            const mesesPt = [
                "janeiro", "fevereiro", "março", "abril", "maio", "junho",
                "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"
            ];
            const nomeMes = mesesPt[mesIndex];
            return `${diaFormatado} de ${nomeMes} de ${ano}`;
        }

        function gerarCertificado() {
            const nomeCompleto = document.getElementById('nome').value;
            const dataSelecionada = document.getElementById('data').value;

            if (!nomeCompleto || !dataSelecionada) {
                alert("Por favor, preencha o nome e a data.");
                return;
            }

            const imagemPlanoDeFundo = new Image();
            imagemPlanoDeFundo.src = "certificado.png"; // Certifique-se que está na mesma pasta

            // Evento disparado QUANDO A IMAGEM É COMPLETAMENTE CARREGADA
            imagemPlanoDeFundo.onload = function() {
                // ---- INÍCIO DA MODIFICAÇÃO PARA CONVERTER IMAGEM PARA DATA URL ----
                const canvas = document.createElement('canvas');
                canvas.width = this.naturalWidth; // Usa a largura natural da imagem carregada
                canvas.height = this.naturalHeight; // Usa a altura natural da imagem carregada

                const ctx = canvas.getContext('2d');
                ctx.drawImage(this, 0, 0); // 'this' aqui é a imagemPlanoDeFundo

                // Converte o conteúdo do canvas para uma Data URL (string base64)
                const imageDataUrl = canvas.toDataURL('image/png');
                // ---- FIM DA MODIFICAÇÃO PARA CONVERTER IMAGEM PARA DATA URL ----

                // Agora, o resto da geração do PDF continua, mas usando imageDataUrl

                const dataFormatada = formatarDataParaPdf(dataSelecionada); // Sua função de formatar data
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'landscape' });

                const larguraPagina = doc.internal.pageSize.getWidth();
                const alturaPagina = doc.internal.pageSize.getHeight();

                // ADICIONAR A IMAGEM DE PLANO DE FUNDO USANDO A DATA URL
                doc.addImage(imageDataUrl, 'PNG', 0, 0, larguraPagina, alturaPagina);

                // ADICIONAR TODO O TEXTO DO CERTIFICADO SOBRE A IMAGEM
                // Lembre-se que estas posições (yPos, xPos) provavelmente precisarão de ajuste
                let yPos = 20;
                const xPos = 20;
                const lineHeight = 8;
                const paragraphSpacing = 4;

                doc.setFontSize(12);

                doc.text("A comunidade da", xPos, yPos);
                yPos += lineHeight;
                doc.text("Vila da Calderita", xPos, yPos);
                yPos += lineHeight + paragraphSpacing;

                doc.text("representada por sua Associação dos Moradores e Amigos da Vila Calderita (AMAVICA),", xPos, yPos);
                yPos += lineHeight;
                doc.text("confere o título de:", xPos, yPos);
                yPos += lineHeight + paragraphSpacing;

                doc.setFontSize(14);
                doc.text("Amigo(a) da Calderita", xPos, yPos);
                yPos += lineHeight;
                doc.setFontSize(12);
                doc.text("a(o) Senhor(a) " + nomeCompleto, xPos, yPos);
                yPos += lineHeight + paragraphSpacing;

                doc.text("por seu reconhecido mérito em sua atuação participativa na Comunidade", xPos, yPos);
                yPos += lineHeight;
                doc.text("em seus serviços voluntários relevantes.", xPos, yPos);
                yPos += lineHeight + paragraphSpacing * 2;

                doc.text("Porto Velho, " + dataFormatada + ".", xPos, yPos);
                yPos += lineHeight * 3.5;

                const signatureLine = "_________________________________________";
                doc.text(signatureLine, xPos, yPos);
                yPos += lineHeight;
                doc.text("Maria Nazira Freitas de Sá (Presidente)", xPos, yPos);
                yPos += lineHeight * 2;

                doc.text(signatureLine, xPos, yPos);
                yPos += lineHeight;
                doc.text("Anselmo Duarte (Vice-Presidente)", xPos, yPos);

                doc.save("Certificado_VilaCalderita_" + nomeCompleto.replace(/ /g, "_") + ".pdf");

            }; // Fim do imagemPlanoDeFundo.onload

            imagemPlanoDeFundo.onerror = function() {
                alert("Erro ao carregar a imagem de fundo 'certificado.png'. Verifique o console para mais detalhes e se o arquivo está na mesma pasta que o index.html.");
                console.error("Erro ao carregar a imagem: ", imagemPlanoDeFundo.src);
            };
        }
    </script>

</body>
</html>